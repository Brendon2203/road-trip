<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ROAD-TRIP</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Firebase SDKs compat√≠veis com HTML puro -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

    <script>
        // Sua configura√ß√£o Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyCpnWEUipuAR_Mx1IFuaSzsqFq7bi7MWx0",
            authDomain: "road-trip-17bfc.firebaseapp.com",
            projectId: "road-trip-17bfc",
            storageBucket: "road-trip-17bfc.firebasestorage.app",
            messagingSenderId: "919284765323",
            appId: "1:919284765323:web:a7a0a2354affd43a44ba8e",
            measurementId: "G-62KCWR7Y2Y"
        };

        // Inicializa Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const storage = firebase.storage();
    </script>

    <style>
        .slide {
            display: none;
            animation: fade 0.5s ease-in-out;
        }

        @keyframes fade {
            from {
                opacity: 0.4
            }

            to {
                opacity: 1
            }
        }

        .active-slide {
            display: block;
        }

        .dot {
            cursor: pointer;
            height: 10px;
            width: 10px;
            margin: 0 4px;
            background-color: #bbb;
            border-radius: 50%;
            display: inline-block;
            transition: background-color 0.3s ease;
        }

        .active-dot,
        .dot:hover {
            background-color: #4f46e5;
        }

        .admin-panel {
            transition: all 0.3s ease;
            max-height: none;
            overflow: visible;
        }

        .admin-panel.open {
            max-height: none;
        }

        .progress-bar {
            transition: width 0.5s ease;
        }

        .expandable-row {
            cursor: pointer;
            transition: background 0.2s;
        }

        .expandable-row:hover {
            background: #ede9fe;
        }

        .expand-content {
            display: none;
            background: #f5f3ff;
        }

        .expand-content.open {
            display: table-row;
        }

        .months-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .delete-btn {
            background: #dc2626;
            color: #fff;
            border: none;
            border-radius: 6px;
            padding: 0.25rem 0.75rem;
            font-size: 0.9rem;
            margin-top: 1rem;
            cursor: pointer;
            transition: background 0.2s;
        }

        .delete-btn:hover {
            background: #b91c1c;
        }

        .edit-input {
            border: 1px solid #6366f1;
            border-radius: 6px;
            padding: 0.1rem 0.5rem;
            font-size: 1.1rem;
            width: 120px;
            text-align: right;
        }

        .action-btn {
            background: #4f46e5;
            color: #fff;
            border: none;
            border-radius: 6px;
            padding: 0.5rem 1.2rem;
            font-size: 1rem;
            margin: 0.5rem 0.5rem 0 0;
            cursor: pointer;
            transition: background 0.2s;
            box-shadow: 0 2px 8px #6366f133;
        }

        .action-btn:hover {
            background: #3730a3;
        }

        .banner-link-btn {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.9);
            color: #4f46e5;
            padding: 12px 24px;
            border-radius: 25px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .banner-link-btn:hover {
            background: rgba(255, 255, 255, 1);
            transform: translateX(-50%) scale(1.05);
        }

        /* Estilos para a funcionalidade de arquivos */
        .file-card {
            transition: all 0.2s ease;
        }

        .file-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .preview-modal {
            animation: modalFadeIn 0.3s ease;
        }

        @keyframes modalFadeIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .tab-button {
            transition: all 0.2s ease;
        }

        .tab-button:hover {
            background-color: #f3f4f6;
        }

        .filter-section {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
        }

        .inicial-link-btn {
            justify-content: center;
            text-align: center;
            align-items: center;
            margin: auto;
            display: flex;
            width: 300px;
            background: #51e085;
            color: #fff;

            border-radius: 8px;
            padding: 0.6rem 1.3rem;
            font-size: 1rem;
            box-shadow: 0 2px 8px #6366f133;
            cursor: pointer;
            transition: background 0.2s;
            opacity: 0.95;
            margin-top: 40px;
        }

        .inicial-link-btn:hover {
            background: #18e061;
            opacity: 1;
        }

        .banner-link-container {
            position: relative;
        }
    </style>
</head>

<body class="bg-gradient-to-br from-indigo-50 to-purple-50 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <header class="text-center mb-10">
            <h1 class="text-4xl md:text-5xl font-bold text-indigo-900 mb-2">üåü Virada do Ano em Guarapari + Show do
                Martin Garrix üéâ</h1>
            <br>
            <h2 class="text-2xl md:text-3xl font-semibold text-purple-800">O Show vai acontecer no dia: <br><br> 02 de
                Janeiro de 2026</h2>

            <!-- Countdown -->
            <div class="mt-8 bg-white rounded-xl shadow-lg p-6 max-w-2xl mx-auto">
                <h3 class="text-xl font-semibold text-gray-800 mb-4">Contagem regressiva para o show:</h3>
                <div class="flex justify-center gap-4">
                    <div class="text-center">
                        <div class="text-3xl font-bold text-indigo-600" id="days">00</div>
                        <div class="text-sm text-gray-600">Dias</div>
                    </div>
                    <div class="text-center">
                        <div class="text-3xl font-bold text-indigo-600" id="hours">00</div>
                        <div class="text-sm text-gray-600">Horas</div>
                    </div>
                    <div class="text-center">
                        <div class="text-3xl font-bold text-indigo-600" id="minutes">00</div>
                        <div class="text-sm text-gray-600">Minutos</div>
                    </div>
                    <div class="text-center">
                        <div class="text-3xl font-bold text-indigo-600" id="seconds">00</div>
                        <div class="text-sm text-gray-600">Segundos</div>
                    </div>
                </div>
            </div>
            <a href="https://zig.tickets/eventos/martin-garrix" target="_blank" class="inicial-link-btn">Comprar
                Ingresso para o show!!</a>
        </header>
        <!-- Planejamento do rol√© -->
        <section>
            <h3 class="text-3xl font-semibold text-indigo-900 mb-4 text-center">Comprei meu ingresso e agora?</h3>
            <div class="mt-8 bg-white rounded-xl shadow-lg p-6 max-w-2xl mx-auto mb-10 p-8">
                <h3 class="text-2xl font-semibold text-indigo-900 mb-4 ">üöô Planejamento </h3>
                <p class="text-gray-700">Estamos organizando uma viagem em grupo para curtir a virada do ano em
                    Guarapari e, de quebra, aproveitar o show do Martin Garrix! A ideia √© reunir os amigos e alugar uma
                    casa ou hotel para garantir bons momentos juntos.</p>
                <br>
                <p class="text-gray-700 font-bold ml-4">üìÖ Datas da viagem</p>
                <br>
                <li class="ml-8"> Check-in: 30/12/2025</li>
                <li class="ml-8"> Check-out: 04/01/2026</li>
                <br>
                <h3 class="text-2xl font-semibold text-indigo-900 mb-4 ">üí∞ Organiza√ß√£o da Viagem</h3>
                <li class="ml-8"> Hospedagem</li>
                <li class="ml-8"> Alimenta√ß√£o</li>
                <li class="ml-8"> Transporte</li>
                <li class="ml-8"> Passeios (opcional, conforme interesse do grupo)</li>
                <li class="ml-8"> Reserva para emerg√™ncias</li>
                <br>
                <h3 class="text-2xl font-semibold text-indigo-900 mb-4 ">‚úÖ Como Participar</h3>
                <br>

                <li class="ml-8"> Entre em contato pelo WhatsApp para saber se ainda h√° vagas dispon√≠veis.
                    ‚ö†Ô∏è As vagas s√£o limitadas, ent√£o √© importante garantir a sua o quanto antes</li>
                <br>
                <li class="ml-8"> O valor total ser√° dividido igualmente entre todos os participantes.</li>
                <br>
                <li class="ml-8"> Ap√≥s o pagamento da primeira parcela, seu nome estar√° confirmado na lista oficial
                    da viagem.</li>
                <br>
                <h3 class="text-2xl font-semibold text-indigo-900 mb-4 ">‚ùó Pol√≠tica de Cancelamento</h3>
                <p>Caso algu√©m desista ap√≥s confirmar a participa√ß√£o, ser√° retido entre 30% a 50% do valor j√° investido,
                    para evitar preju√≠zos aos demais.</p>
                <br>
                <p>A porcentagem retida depende do tempo de organiza√ß√£o j√° investido:</p>
                <br>
                <li class="ml-8">Quanto mais cedo o cancelamento, maior a porcentagem retida.</li>
                <br>
                <li class="ml-8"> Quanto mais tarde o cancelamento, menor a porcentagem retida.</li>
                <br>
                <a href="https://chat.whatsapp.com/CxhD33Q1oW6KlUbdqVgD7u" target="_blank"
                    class="inicial-link-btn">Quero fazer esse role acontecer!</a>
            </div>
        </section>
        <!-- House Gallery -->
        <section>
            <h3 class="text-2xl font-semibold text-indigo-900 mb-4 text-center">Informa√ß√µes sobre a casa</h3>
            <div class="bg-white rounded-xl shadow-lg overflow-hidden max-w-4xl mx-auto banner-link-container">
                <div class="px-6 py-4">
                    <p>Casa aconchegante a 300m da Praia de Peracanga, perto da Bacutia e do
                        centro de Guarapari. A 3 min do Multiplace Mais e 6 min da P12. Possui piscina com
                        cascata, hidromassagem, √°rea gourmet com churrasqueira e cervejeira, sala com TV de 65"
                        e cozinha completa. Ideal para curtir com amigos ou fam√≠lia!

                    </p>
                </div>
                <!-- Slides -->
                <div class="house-slides relative h-64 md:h-96">
                    <div class="slide active-slide">
                        <img src="https://a0.muscache.com/im/pictures/hosting/Hosting-U3RheVN1cHBseUxpc3Rpbmc6MTI4NzYzNzAzMjQ1Mjk4MjQyNg%3D%3D/original/644bf022-913e-4afd-86a4-d8dd9e8bbbaa.jpeg?im_w=1440"
                            alt="Casa de luxo" class="w-full h-full object-cover">
                    </div>
                    <div class="slide">
                        <img src="https://a0.muscache.com/im/pictures/hosting/Hosting-1287637032452982426/original/0496cfae-46b0-48ee-9ff0-3cbdb21b0795.jpeg?im_w=1440"
                            alt="Sala de estar" class="w-full h-full object-cover">
                    </div>
                    <div class="slide">
                        <img src="https://images.unsplash.com/photo-1600585154340-be6161a56a0c?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1470&q=80"
                            alt="Cozinha moderna" class="w-full h-full object-cover">
                    </div>
                    <div class="slide">
                        <img src="https://images.unsplash.com/photo-1605276374104-dee2a0ed3cd6?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1470&q=80"
                            alt="Quartos espa√ßosos" class="w-full h-full object-cover">

                    </div>

                    <!-- Navigation arrows -->
                    <button
                        class="absolute left-4 top-1/2 transform -translate-y-1/2 bg-white/80 hover:bg-white text-gray-800 p-2 rounded-full shadow-md transition duration-300"
                        onclick="plusSlides(-1, 'house')">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <button
                        class="absolute right-4 top-1/2 transform -translate-y-1/2 bg-white/80 hover:bg-white text-gray-800 p-2 rounded-full shadow-md transition duration-300"
                        onclick="plusSlides(1, 'house')">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                    <a href="https://www.airbnb.com.br/rooms/1287637032452982426?adults=7&check_in=2025-12-30&check_out=2026-01-04&search_mode=regular_search&source_impression_id=p3_1753106112_P33LOpIw5vibLVtm&previous_page_section_name=1000&federated_search_id=60ce5b81-706c-4278-9eb8-d4f61d9b9b71"
                        target="_blank" class="banner-link-btn">üè° Airbnb</a>


                </div>

                <!-- Dots -->
                <div class="house-dots text-center py-4" style="display: none;">
                    <span class="dot active-dot" onclick="currentSlide(1, 'house')"></span>
                    <span class="dot" onclick="currentSlide(2, 'house')"></span>
                    <span class="dot" onclick="currentSlide(3, 'house')"></span>
                    <span class="dot" onclick="currentSlide(4, 'house')"></span>
                </div>

            </div>

            <h3 class="text-2xl font-semibold text-indigo-900 mb-4 text-center mt-4">Localiza√ß√£o da casa</h3>
            <div class="mt-8 bg-white rounded-xl shadow-lg p-6 max-w-2xl mx-auto mb-10">
                <iframe
                    src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d932.8916241116619!2d-40.53132417152731!3d-20.727820944499594!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0xb8f91fb50bb667%3A0xf94941da868b420e!2sR.%20la%20Paloma%2C%20371%20-%20Enseada%20Azul%2C%20Guarapari%20-%20ES%2C%2029206-090!5e0!3m2!1spt-BR!2sbr!4v1753365303376!5m2!1spt-BR!2sbr"
                    width="80%" height="450px" style="border-radius:16px;" allowfullscreen="" loading="lazy"
                    referrerpolicy="no-referrer-when-downgrade" class="mx-auto"></iframe>
            </div>
        </section>

        <!-- Show Gallery -->
        <section class="mb-12">
            <h3 class="text-2xl font-semibold text-indigo-900 mb-4 text-center">O Show e o DJ</h3>

            <div class="bg-white rounded-xl shadow-lg overflow-hidden max-w-4xl mx-auto banner-link-container">
                <div class="px-6 py-4">
                    <p class="text-gray-700">No dia 2 de Janeiro, o fen√¥meno MARTIN GARRIX chega no Brava Beach Club
                        para uma noite hist√≥rica no Esp√≠rito Santo! </p>
                </div>
                <!-- Slides -->
                <div class=" show-slides h-64 md:h-96">
                    <div class="slide active-slide">
                        <img src="https://images.unsplash.com/photo-1470229722913-7c0e2dbbafd3?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1470&q=80"
                            alt="Show de m√∫sica eletr√¥nica" class="w-full h-full object-cover">
                    </div>
                    <div class="slide">
                        <img src="https://images.unsplash.com/photo-1501612780327-45045538702b?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1470&q=80"
                            alt="DJ tocando" class="w-full h-full object-cover">
                    </div>
                    <div class="slide">
                        <img src="https://images.unsplash.com/photo-1496293455970-f8581aae0e3b?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1471&q=80"
                            alt="P√∫blico animado" class="w-full h-full object-cover">
                    </div>

                    <!-- Navigation arrows -->
                    <button
                        class="absolute left-4 top-1/2 transform -translate-y-1/2 bg-white/80 hover:bg-white text-gray-800 p-2 rounded-full shadow-md transition duration-300"
                        onclick="plusSlides(-1, 'show')">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <button
                        class="absolute right-4 top-1/2 transform -translate-y-1/2 bg-white/80 hover:bg-white text-gray-800 p-2 rounded-full shadow-md transition duration-300"
                        onclick="plusSlides(1, 'show')">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                    <a href="https://zig.tickets/eventos/martin-garrix" target="_blank" class="banner-link-btn">üéüÔ∏è
                        Comprar
                        Ingresso</a>
                </div>

                <!-- Dots -->
                <div class="show-dots text-center py-4" style="display: none;">
                    <span class="dot active-dot" onclick="currentSlide(1, 'show')"></span>
                    <span class="dot" onclick="currentSlide(2, 'show')"></span>
                    <span class="dot" onclick="currentSlide(3, 'show')"></span>
                </div>
            </div>

            <h3 class="text-2xl font-semibold text-indigo-900 mb-4 text-center mt-8">Localiza√ß√£o do evento</h3>
            <div class="mt-8 bg-white rounded-xl shadow-lg p-6 max-w-2xl mx-auto mb-10">
                <iframe
                    src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3731.8254032395143!2d-40.525017724820664!3d-20.71731338085521!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0xb8f96070ebee7d%3A0x191ece0a919d27d2!2sBrava%20Beach%20Club!5e0!3m2!1spt-BR!2sbr!4v1751494977574!5m2!1spt-BR!2sbr"
                    width="80%" height="450px" style="border-radius:16px;" allowfullscreen="" loading="lazy"
                    referrerpolicy="no-referrer-when-downgrade" class="mx-auto"></iframe>
            </div>
        </section>

        <!-- Payment Summary -->
        <h3 class="text-2xl font-semibold text-indigo-900 mb-8 text-center mt-4 ">Or√ßamento necessario para o rol√©</h3>
        <section class="mb-12 bg-white rounded-xl shadow-lg p-6 max-w-4xl mx-auto">
            <h3 class="text-2xl font-semibold text-indigo-900 mb-6 text-center">Resumo Financeiro</h3>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                <div class="bg-indigo-50 rounded-lg p-4 text-center">
                    <div class="text-sm font-medium text-indigo-700 mb-1">Valor Total</div>
                    <div class="text-2xl font-bold text-indigo-900" id="totalHouseValue" style="cursor:pointer"></div>
                </div>
                <div class="bg-green-50 rounded-lg p-4 text-center">
                    <div class="text-sm font-medium text-green-700 mb-1">Arrecadado</div>
                    <div class="text-2xl font-bold text-green-900" id="totalPaid">R$ 0,00</div>
                </div>
                <div class="bg-red-50 rounded-lg p-4 text-center">
                    <div class="text-sm font-medium text-red-700 mb-1">Falta Pagar</div>
                    <div class="text-2xl font-bold text-red-900" id="remainingAmount">R$ 5.000,00</div>
                </div>
            </div>

            <div class="mb-4">
                <div class="flex justify-between text-sm text-gray-600 mb-1">
                    <span>Progresso do pagamento</span>
                    <span id="progressPercentage">0%</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2.5">
                    <div class="progress-bar bg-indigo-600 h-2.5 rounded-full" style="width: 0%"></div>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="bg-purple-50 rounded-lg p-4">
                    <div class="text-sm font-medium text-purple-700 mb-1">Valor por pessoa</div>
                    <div class="text-xl font-bold text-purple-900" id="perPerson">R$ 0,00</div>
                </div>
                <div class="bg-blue-50 rounded-lg p-4">
                    <div class="text-sm font-medium text-blue-700 mb-1">Parcelas mensais</div>
                    <div class="text-xl font-bold text-blue-900" id="monthlyPayment">R$ 0,00</div>
                </div>
            </div>
        </section>

        <div class="mt-8 bg-white rounded-xl shadow-lg p-6 max-w-2xl mx-auto mb-10 ">
            <h3 class="text-2xl font-semibold text-indigo-900 mb-4 text-center">Pix para pagamento:</h3>
            <img class="mx-auto block max-w-full h-auto" src="img/WhatsApp Image 2025-07-24 at 12.11.09.jpeg"
                alt="img pix">
            <div class="text-center mt-4">
                <h3 class="text-xl font-semibold text-indigo-900 mb-2">Chave PIX: 17282663785</h3>
                <p class="text-gray-600 mb-4">Valor da parcela: <span id="pixValue">R$ 167,65</span></p>
                <button onclick="copyPixKey()" 
                        class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-medium transition duration-200 flex items-center justify-center mx-auto">
                    <i class="fas fa-copy mr-2"></i>
                    Copiar Chave PIX
                </button>
                <button onclick="copyPixKeyOnly()" 
                        class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition duration-200 flex items-center justify-center mx-auto mt-2">
                    <i class="fas fa-key mr-2"></i>
                    Copiar Apenas Chave
                </button>
                <div id="copyStatus" class="mt-2 text-sm text-green-600 font-medium" style="display: none;">
                    <i class="fas fa-check mr-1"></i>Chave PIX copiada!
                </div>
            </div>
        </div>

        <!-- Admin Panel Toggle -->
        <div class="text-center mb-8">
            <button id="adminToggle"
                class="bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-2 px-6 rounded-full transition duration-300">
                <i class="fas fa-lock mr-2"></i> Acesso Administrativo
            </button>
        </div>

        <!-- Admin Panel (Hidden by default) -->
        <div id="adminPanel" class="admin-panel bg-white rounded-xl shadow-lg p-6 mb-10 max-w-4xl mx-auto"
            style="display:none">
            <h3 class="text-xl font-semibold text-gray-800 mb-4">Painel Administrativo</h3>

            <!-- Tabs para navega√ß√£o -->
            <div class="flex border-b border-gray-200 mb-6">
                <button id="participantsTab" class="tab-button px-4 py-2 text-sm font-medium text-indigo-600 border-b-2 border-indigo-600">
                    Participantes
                </button>
                <button id="filesTab" class="tab-button px-4 py-2 text-sm font-medium text-gray-500 hover:text-gray-700">
                    Arquivos Enviados
                </button>
            </div>

            <!-- Tab Participantes -->
            <div id="participantsTabContent">
                <div class="mb-6">
                    <label for="newPerson" class="block text-sm font-medium text-gray-700 mb-1">Adicionar Pessoa:</label>
                    <div class="flex">
                        <input type="text" id="newPerson"
                            class="flex-1 rounded-l-lg border border-gray-300 px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                            placeholder="Nome completo">
                        <input type="text" id="newPersonCPF"
                            class="border border-gray-300 px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                            placeholder="CPF (apenas n√∫meros)" maxlength="11">
                        <button id="addPersonBtn"
                            class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-r-lg transition duration-300">
                            <i class="fas fa-plus mr-1"></i> Adicionar
                        </button>
                    </div>
                    <div class="mt-2">
                        <button id="createTestBtn" onclick="createTestParticipants()"
                            class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm transition duration-300">
                            <i class="fas fa-magic mr-1"></i> Criar Participantes de Teste
                        </button>
                        <button id="clearListBtn" onclick="clearParticipantsList()"
                            class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg text-sm transition duration-300 ml-2">
                            <i class="fas fa-trash mr-1"></i> Limpar Lista
                        </button>
                    </div>
                </div>

                <div class="mb-4">
                    <label for="adminPassword" class="block text-sm font-medium text-gray-700 mb-1">Senha de
                        Administrador:</label>
                    <input type="password" id="adminPassword"
                        class="w-full rounded-lg border border-gray-300 px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                        placeholder="Digite a senha">
                </div>
            </div>

            <!-- Tab Arquivos -->
            <div id="filesTabContent" style="display: none;">
                <div class="mb-4">
                    <h4 class="text-lg font-medium text-gray-800 mb-2">Arquivos Enviados pelos Participantes</h4>
                    <p class="text-sm text-gray-600 mb-4">Visualize e baixe os comprovantes de pagamento enviados pelos participantes.</p>
                </div>

                <div id="filesList" class="space-y-4">
                    <!-- Arquivos ser√£o listados aqui dinamicamente -->
                </div>

                <div class="mt-4 p-4 filter-section rounded-lg">
                    <h5 class="font-medium text-gray-800 mb-2">Filtros:</h5>
                    <div class="flex flex-wrap gap-4">
                        <label class="flex items-center">
                            <input type="checkbox" id="filterImages" checked class="mr-2">
                            <span class="text-sm">Imagens</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" id="filterPDFs" checked class="mr-2">
                            <span class="text-sm">PDFs</span>
                        </label>
                        <select id="filterParticipant" class="text-sm border border-gray-300 rounded px-2 py-1">
                            <option value="">Todos os participantes</option>
                        </select>
                        <select id="filterMonth" class="text-sm border border-gray-300 rounded px-2 py-1">
                            <option value="">Todos os meses</option>
                            <option value="0">Agosto</option>
                            <option value="1">Setembro</option>
                            <option value="2">Outubro</option>
                            <option value="3">Novembro</option>
                            <option value="4">Dezembro</option>
                            <option value="5">Janeiro</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <!-- Participants List -->
        <section class="bg-white rounded-xl shadow-lg p-6 max-w-4xl mx-auto">
            <h3 class="text-2xl font-semibold text-indigo-900 mb-6 text-center">Lista de Participantes</h3>

            <!-- Informa√ß√µes sobre seguran√ßa -->
            <div class="mb-6 p-4 bg-blue-50 rounded-lg border border-blue-200">
                <div class="flex items-start">
                    <i class="fas fa-shield-alt text-blue-600 mt-1 mr-3"></i>
                    <div>
                        <h4 class="text-sm font-medium text-blue-800 mb-1">Seus arquivos est√£o seguros!</h4>
                        <p class="text-xs text-blue-700">
                            ‚Ä¢ Todos os comprovantes s√£o armazenados em servidores seguros da Google (Firebase)<br>
                            ‚Ä¢ Backup autom√°tico realizado a cada 24 horas<br>
                            ‚Ä¢ Seus arquivos nunca ser√£o perdidos, mesmo em caso de problemas t√©cnicos<br>
                            ‚Ä¢ Apenas voc√™ e o administrador podem acessar seus documentos
                        </p>
                    </div>
                </div>
            </div>

            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr class="text-left border-b border-gray-200">
                            <th class="pb-2 text-sm font-medium text-gray-700">Nome</th>
                            <th class="pb-2 text-sm font-medium text-gray-700 text-center">Pagamento</th>
                            <th class="pb-2 text-sm font-medium text-gray-700 text-right">Valor Pago</th>
                        </tr>
                    </thead>
                    <tbody id="participantsList">
                        <!-- Participants will be added here dynamically -->
                    </tbody>
                </table>
            </div>

            <div class="mt-4 text-sm text-gray-500">
                <i class="fas fa-info-circle mr-1"></i> Apenas o administrador pode editar os pagamentos.
            </div>
        </section>

        <!-- Footer -->
        <footer class="mt-12 text-center text-gray-600 text-sm">
            <p>Viagem para o show em 02/01/2026 ‚Ä¢ Aluguel da casa: 30/12/2025 a 04/01/2026</p>
            <p class="mt-1">Desenvolvido com ‚ù§Ô∏è para amigos</p>
        </footer>
    </div>

    <script>
        // Countdown to the show
        function updateCountdown() {
            const showDate = new Date('2026-01-02T00:00:00').getTime();
            const now = new Date().getTime();
            const distance = showDate - now;

            const days = Math.floor(distance / (1000 * 60 * 60 * 24));
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((distance % (1000 * 60)) / 1000);

            document.getElementById('days').textContent = days.toString().padStart(2, '0');
            document.getElementById('hours').textContent = hours.toString().padStart(2, '0');
            document.getElementById('minutes').textContent = minutes.toString().padStart(2, '0');
            document.getElementById('seconds').textContent = seconds.toString().padStart(2, '0');
        }

        setInterval(updateCountdown, 1000);
        updateCountdown();

        // Slideshow functionality
        let slideIndex = {
            house: 1,
            show: 1
        };

        function showSlides(type) {
            const slides = document.querySelectorAll(`.${type}-slides .slide`);
            const dots = document.querySelectorAll(`.${type}-dots .dot`);
            if (slides.length === 0) return;

            for (let i = 0; i < slides.length; i++) {
                slides[i].style.display = "none";
            }
            for (let i = 0; i < dots.length; i++) {
                dots[i].classList.remove("active-dot");
            }

            slides[slideIndex[type] - 1].style.display = "block";
            dots[slideIndex[type] - 1].classList.add("active-dot");
        }

        function plusSlides(n, type) {
            const slides = document.querySelectorAll(`.${type}-slides .slide`);
            if (slides.length === 0) return;

            slideIndex[type] += n;
            if (slideIndex[type] > slides.length) { slideIndex[type] = 1; }
            if (slideIndex[type] < 1) { slideIndex[type] = slides.length; }
            showSlides(type);
        }

        function currentSlide(n, type) {
            slideIndex[type] = n;
            showSlides(type);
        }

        // Initialize slides
        showSlides('house');
        showSlides('show');

        // Admin panel toggle
        const adminToggle = document.getElementById('adminToggle');
        const adminPanel = document.getElementById('adminPanel');
        let isAdmin = false;

        function updateAdminPanel() {
            if (isAdmin) {
                adminPanel.style.display = '';
            } else {
                adminPanel.style.display = 'none';
            }
            // Sempre renderizar participantes e resumo, independente do admin
            renderParticipants();
            updatePaymentSummary();
        }

        adminToggle.addEventListener('click', () => {
            if (!isAdmin) {
                const password = prompt("Digite a senha de administrador:");
                if (password === "amigos2026") {
                    isAdmin = true;
                    adminToggle.innerHTML = '<i class="fas fa-unlock mr-2"></i> Modo Administrador Ativo';
                    adminToggle.classList.remove('bg-indigo-600', 'hover:bg-indigo-700');
                    adminToggle.classList.add('bg-green-600', 'hover:bg-green-700');
                } else {
                    alert("Senha incorreta!");
                }
            } else {
                isAdmin = false;
                adminToggle.innerHTML = '<i class="fas fa-lock mr-2"></i> Acesso Administrativo';
                adminToggle.classList.remove('bg-green-600', 'hover:bg-green-700');
                adminToggle.classList.add('bg-indigo-600', 'hover:bg-indigo-700');
            }
            updateAdminPanel();
        });

        // Meses de Agosto a Janeiro
        const monthNames = ["Agosto", "Setembro", "Outubro", "Novembro", "Dezembro", "Janeiro"];
        let totalHouseValue = 5000;
        let participants = [];
        let expandedIdx = null;
        let authenticatedCPF = null; // CPF autenticado para upload de comprovantes
        
        // Refer√™ncias do Firestore
        const totalValueDoc = db.collection('viagem').doc('totalHouseValue');
        const participantsCol = db.collection('viagem').doc('data').collection('participants');

        // Fun√ß√£o para autenticar CPF
        function authenticateCPF(cpf) {
            // Verifica se o CPF existe na lista de participantes
            const participant = participants.find(p => p.cpf === cpf);
            if (participant) {
                authenticatedCPF = cpf;
                return true;
            }
            return false;
        }

        // Fun√ß√£o para autenticar usu√°rio (chamada pelo bot√£o)
        window.authenticateUser = function(participantIndex) {
            const cpfInput = document.getElementById(`authCPF-${participantIndex}`);
            let cpf = cpfInput.value.trim();
            
            // Remover caracteres especiais (pontos, tra√ßos, espa√ßos)
            cpf = cpf.replace(/[^\d]/g, '');
            
            if (!cpf) {
                alert('Digite seu CPF para continuar.');
                return;
            }
            
            if (cpf.length !== 11) {
                alert('CPF deve conter exatamente 11 n√∫meros.');
                return;
            }
            
            if (authenticateCPF(cpf)) {
                alert('Autentica√ß√£o realizada com sucesso! Agora voc√™ pode enviar comprovantes.');
                renderParticipants(); // Atualizar interface
            } else {
                alert('CPF n√£o encontrado na lista de participantes.');
            }
        };

        // Fun√ß√£o para verificar se o usu√°rio est√° autenticado
        function isAuthenticated() {
            return authenticatedCPF !== null;
        }

        // Carregar valor total em tempo real
        totalValueDoc.onSnapshot(doc => {
            if (doc.exists) {
                totalHouseValue = doc.data().value;
                renderParticipants();
            }
        });
        // Carregar participantes em tempo real
        participantsCol.orderBy('name').onSnapshot(snapshot => {
            participants = [];
            snapshot.forEach(doc => {
                participants.push({ ...doc.data(), id: doc.id });
            });
            renderParticipants();
        });
        function saveTotalHouseValue(val) {
            totalValueDoc.set({ value: val });
        }
        function addParticipant(name, cpf) {
            participantsCol.add({ 
                name, 
                cpf, 
                monthsPaid: [false, false, false, false, false, false], 
                proofs: [null, null, null, null, null, null] 
            });
        }
        function updateParticipant(id, data) {
            participantsCol.doc(id).update(data);
        }
        function deleteParticipantFirestore(id) {
            participantsCol.doc(id).delete();
        }
        function getPerPerson() {
            return participants.length > 0 ? totalHouseValue / participants.length : 0;
        }
        function getPerMonth() {
            return getPerPerson() / 6;
        }
        function getTotalPaid() {
            let total = 0;
            participants.forEach(p => {
                total += p.monthsPaid.filter(Boolean).length * getPerMonth();
            });
            return total;
        }
        function renderParticipants() {
            const participantsList = document.getElementById('participantsList');
            participantsList.innerHTML = '';
            participants.forEach((participant, idx) => {
                // Linha principal
                const tr = document.createElement('tr');
                tr.className = 'border-b border-gray-100 expandable-row';
                tr.onclick = function (e) {
                    if (e.target.tagName === 'INPUT' || e.target.classList.contains('delete-btn') || e.target.tagName === 'BUTTON') return;
                    if (expandedIdx === idx) {
                        expandedIdx = null;
                    } else {
                        expandedIdx = idx;
                    }
                    renderParticipants();
                };
                // Nome
                const tdName = document.createElement('td');
                tdName.className = 'py-3 text-indigo-900 font-semibold';
                tdName.textContent = participant.name;
                // Pagamento geral
                const tdStatus = document.createElement('td');
                tdStatus.className = 'py-3 text-center';
                const pagos = participant.monthsPaid.filter(Boolean).length;
                tdStatus.innerHTML = `<span class="${pagos === 6 ? 'text-green-600' : pagos > 0 ? 'text-yellow-600' : 'text-red-600'} font-medium">${pagos === 6 ? 'Completo' : pagos > 0 ? 'Parcial' : 'Pendente'}</span>`;
                // Valor pago
                const tdValor = document.createElement('td');
                tdValor.className = 'py-3 text-right font-medium';
                tdValor.innerHTML = `R$ ${(pagos * getPerMonth()).toFixed(2).replace('.', ',')}`;
                tr.appendChild(tdName);
                tr.appendChild(tdStatus);
                tr.appendChild(tdValor);
                participantsList.appendChild(tr);
                // Linha expans√≠vel
                const trExpand = document.createElement('tr');
                trExpand.className = 'expand-content' + (expandedIdx === idx ? ' open' : '');
                trExpand.id = 'expand-' + idx;
                const tdExpand = document.createElement('td');
                tdExpand.colSpan = 3;
                tdExpand.className = 'py-2 px-4';
                
                // Verificar se o usu√°rio est√° autenticado para este participante
                const canUploadProofs = isAuthenticated() && authenticatedCPF === participant.cpf;
                
                // Meses com checkbox e upload de comprovantes
                let mesesHtml = '<div class="months-list">';
                participant.monthsPaid.forEach((paid, mIdx) => {
                    const hasProof = participant.proofs[mIdx];
                    mesesHtml += `<div class="flex items-center gap-2 bg-white rounded shadow px-2 py-1 mb-2">
                        <input type="checkbox" data-pidx="${idx}" data-midx="${mIdx}" ${paid ? 'checked' : ''} ${!isAdmin ? 'disabled' : ''} onchange="toggleMonthPayment(this)">
                        <span class="${paid ? 'text-green-700' : 'text-gray-700'} min-w-[80px]">${monthNames[mIdx]}</span>
                        <span class="text-xs ml-1">R$ ${getPerMonth().toFixed(2).replace('.', ',')}</span>
                        ${canUploadProofs ? `
                            <div class="flex items-center gap-1 ml-2">
                                <input type="file" 
                                       data-pidx="${idx}" 
                                       data-midx="${mIdx}" 
                                       accept="image/*,.pdf" 
                                       onchange="uploadProof(this)" 
                                       class="text-xs">
                                ${hasProof ? `
                                    <button onclick="previewUserFile('${hasProof}', '${participant.name} - ${monthNames[mIdx]}')" 
                                            class="text-blue-600 hover:text-blue-800 ml-1 transition-colors duration-200" 
                                            title="Visualizar arquivo">
                                        <i class="fas fa-eye text-sm"></i>
                                    </button>
                                    <span class="text-green-600 text-xs ml-1 font-medium">‚úì Enviado</span>
                                    <span class="text-gray-400 text-xs ml-1">‚Ä¢</span>
                                    <span class="text-gray-500 text-xs">Seguro no servidor</span>
                                ` : '<span class="text-gray-500 text-xs ml-1">Sem comprovante</span>'}
                            </div>
                        ` : ''}
                    </div>`;
                });
                mesesHtml += '</div>';
                
                // Bot√£o de autentica√ß√£o se n√£o estiver autenticado
                if (!canUploadProofs) {
                    mesesHtml += `
                        <div class="mt-3 p-3 bg-gray-50 rounded-lg">
                            <p class="text-sm text-gray-600 mb-2">Para adicionar comprovantes, digite seu CPF:</p>
                            <div class="flex gap-2">
                                <input type="text" 
                                       id="authCPF-${idx}" 
                                       placeholder="Digite seu CPF" 
                                       maxlength="11" 
                                       onkeypress="if(event.key === 'Enter') authenticateUser(${idx})"
                                       class="flex-1 px-3 py-2 border border-gray-300 rounded-lg">
                                <button onclick="authenticateUser(${idx})" 
                                        class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg text-sm transition duration-200">
                                    Autenticar
                                </button>
                            </div>
                        </div>
                    `;
                } else {
                    mesesHtml += `
                        <div class="mt-3 p-3 bg-green-50 rounded-lg border border-green-200">
                            <div class="flex items-center">
                                <i class="fas fa-check-circle text-green-600 mr-2"></i>
                                <span class="text-sm text-green-800 font-medium">Autenticado como ${participant.name}</span>
                                <button onclick="logoutUser()" 
                                        class="ml-auto text-xs text-red-600 hover:text-red-800 transition duration-200">
                                    Sair
                                </button>
                            </div>
                        </div>
                    `;
                }
                
                if (isAdmin) {
                    mesesHtml += `<button class="delete-btn" onclick="deleteParticipant('${participant.id}')">Excluir participante</button>`;
                }
                tdExpand.innerHTML = mesesHtml;
                trExpand.appendChild(tdExpand);
                participantsList.appendChild(trExpand);
            });
            updatePaymentSummary();
        }
        window.toggleMonthPayment = function (checkbox) {
            if (!isAdmin) return;
            const pidx = +checkbox.dataset.pidx;
            const midx = +checkbox.dataset.midx;
            const participant = participants[pidx];
            const newMonthsPaid = [...participant.monthsPaid];
            newMonthsPaid[midx] = checkbox.checked;
            updateParticipant(participant.id, { monthsPaid: newMonthsPaid });
        };
        window.deleteParticipant = function (id) {
            if (!isAdmin) return;
            if (confirm('Tem certeza que deseja excluir este participante?')) {
                deleteParticipantFirestore(id);
                expandedIdx = null;
            }
        };
        function updatePaymentSummary() {
            const totalPaid = getTotalPaid();
            const remaining = totalHouseValue - totalPaid;
            const progress = (totalPaid / totalHouseValue) * 100;
            document.getElementById('totalPaid').textContent = `R$ ${totalPaid.toFixed(2).replace('.', ',')}`;
            document.getElementById('remainingAmount').textContent = `R$ ${remaining.toFixed(2).replace('.', ',')}`;
            document.getElementById('progressPercentage').textContent = `${progress.toFixed(0)}%`;
            document.getElementById('perPerson').textContent = `R$ ${getPerPerson().toFixed(2).replace('.', ',')}`;
            document.getElementById('monthlyPayment').textContent = `R$ ${getPerMonth().toFixed(2).replace('.', ',')}`;
            
            // Atualizar valor do PIX
            const pixValueElement = document.getElementById('pixValue');
            if (pixValueElement) {
                pixValueElement.textContent = `R$ ${getPerMonth().toFixed(2).replace('.', ',')}`;
            }
            
            // Valor total edit√°vel
            const totalValueDiv = document.getElementById('totalHouseValue');
            if (isAdmin) {
                totalValueDiv.innerHTML = `<span id='editTotalValue'>R$ ${totalHouseValue.toFixed(2).replace('.', ',')}</span>`;
            } else {
                totalValueDiv.textContent = `R$ ${totalHouseValue.toFixed(2).replace('.', ',')}`;
            }
            if (isAdmin) {
                const editSpan = document.getElementById('editTotalValue');
                editSpan.onclick = function (e) {
                    e.stopPropagation();
                    const input = document.createElement('input');
                    input.type = 'number';
                    input.className = 'edit-input';
                    input.value = totalHouseValue;
                    input.onblur = saveEdit;
                    input.onkeydown = function (ev) { if (ev.key === 'Enter') saveEdit(); };
                    editSpan.replaceWith(input);
                    input.focus();
                    function saveEdit() {
                        let val = parseFloat(input.value);
                        if (!isNaN(val) && val > 0) {
                            saveTotalHouseValue(val);
                        } else {
                            input.value = totalHouseValue;
                        }
                    }
                };
            }
        }
        document.getElementById('addPersonBtn').addEventListener('click', () => {
            if (!isAdmin) {
                alert("Apenas o administrador pode adicionar pessoas.");
                return;
            }
            const nameInput = document.getElementById('newPerson');
            const cpfInput = document.getElementById('newPersonCPF');
            const name = nameInput.value.trim();
            let cpf = cpfInput.value.trim();
            
            // Remover caracteres especiais (pontos, tra√ßos, espa√ßos)
            cpf = cpf.replace(/[^\d]/g, '');
            
            if (!name) {
                alert("Digite o nome da pessoa.");
                return;
            }
            
            if (!cpf) {
                alert("Digite o CPF da pessoa.");
                return;
            }
            
            if (cpf.length !== 11) {
                alert("CPF deve conter exatamente 11 n√∫meros.");
                return;
            }
            
            // Verificar se o CPF j√° existe
            if (participants.find(p => p.cpf === cpf)) {
                alert("Este CPF j√° est√° cadastrado.");
                return;
            }
            
            addParticipant(name, cpf);
            nameInput.value = '';
            cpfInput.value = '';
        });
        // Initialize
        updateAdminPanel();
        showSlides('house');
        showSlides('show');
        
        // Gerenciamento de Tabs
        document.getElementById('participantsTab').addEventListener('click', () => {
            showTab('participants');
        });
        
        document.getElementById('filesTab').addEventListener('click', () => {
            showTab('files');
        });
        
        function showTab(tabName) {
            // Esconder todos os conte√∫dos
            document.getElementById('participantsTabContent').style.display = 'none';
            document.getElementById('filesTabContent').style.display = 'none';
            
            // Remover classes ativas de todos os tabs
            document.getElementById('participantsTab').classList.remove('text-indigo-600', 'border-indigo-600');
            document.getElementById('participantsTab').classList.add('text-gray-500');
            document.getElementById('filesTab').classList.remove('text-indigo-600', 'border-indigo-600');
            document.getElementById('filesTab').classList.add('text-gray-500');
            
            // Mostrar conte√∫do e ativar tab selecionado
            if (tabName === 'participants') {
                document.getElementById('participantsTabContent').style.display = 'block';
                document.getElementById('participantsTab').classList.remove('text-gray-500');
                document.getElementById('participantsTab').classList.add('text-indigo-600', 'border-indigo-600');
            } else if (tabName === 'files') {
                document.getElementById('filesTabContent').style.display = 'block';
                document.getElementById('filesTab').classList.remove('text-gray-500');
                document.getElementById('filesTab').classList.add('text-indigo-600', 'border-indigo-600');
                renderFilesList();
            }
        }
        
        // Fun√ß√£o para renderizar lista de arquivos
        function renderFilesList() {
            const filesList = document.getElementById('filesList');
            const filterImages = document.getElementById('filterImages').checked;
            const filterPDFs = document.getElementById('filterPDFs').checked;
            const filterParticipant = document.getElementById('filterParticipant').value;
            const filterMonth = document.getElementById('filterMonth').value;
            
            let filesHtml = '';
            let hasFiles = false;
            
            participants.forEach((participant, pIdx) => {
                // Filtrar por participante se especificado
                if (filterParticipant && pIdx.toString() !== filterParticipant) return;
                
                participant.proofs.forEach((proof, mIdx) => {
                    if (!proof) return;
                    
                    // Filtrar por m√™s se especificado
                    if (filterMonth && mIdx.toString() !== filterMonth) return;
                    
                    // Verificar tipo de arquivo
                    const isImage = proof.startsWith('blob:') || proof.includes('image');
                    const isPDF = proof.includes('pdf') || proof.includes('application/pdf');
                    
                    if ((isImage && !filterImages) || (isPDF && !filterPDFs)) return;
                    
                    hasFiles = true;
                    
                    filesHtml += `
                        <div class="file-card bg-white border border-gray-200 rounded-lg p-4 shadow-sm">
                            <div class="flex items-center justify-between">
                                <div class="flex-1">
                                    <h5 class="font-medium text-gray-800">${participant.name}</h5>
                                    <p class="text-sm text-gray-600">CPF: ${participant.cpf}</p>
                                    <p class="text-sm text-gray-600">M√™s: ${monthNames[mIdx]}</p>
                                    <p class="text-sm text-gray-500">Tipo: ${isImage ? 'Imagem' : 'PDF'}</p>
                                </div>
                                <div class="flex items-center gap-2">
                                    <button onclick="previewFile('${proof}', '${participant.name} - ${monthNames[mIdx]}')" 
                                            class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm transition duration-200">
                                        <i class="fas fa-eye mr-1"></i> Visualizar
                                    </button>
                                    <button onclick="downloadFile('${proof}', '${participant.name}_${monthNames[mIdx]}_comprovante')" 
                                            class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-sm transition duration-200">
                                        <i class="fas fa-download mr-1"></i> Baixar
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                });
            });
            
            if (!hasFiles) {
                filesHtml = `
                    <div class="text-center py-8 text-gray-500">
                        <i class="fas fa-file-upload text-4xl mb-4"></i>
                        <p>Nenhum arquivo encontrado com os filtros selecionados.</p>
                    </div>
                `;
            }
            
            filesList.innerHTML = filesHtml;
        }
        
        // Fun√ß√£o para visualizar arquivo
        window.previewFile = function(fileUrl, fileName) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            
            // Melhorar detec√ß√£o do tipo de arquivo
            const isPDF = fileUrl.toLowerCase().includes('.pdf') || fileUrl.toLowerCase().includes('pdf');
            const isImage = fileUrl.toLowerCase().includes('.jpg') || fileUrl.toLowerCase().includes('.jpeg') || 
                           fileUrl.toLowerCase().includes('.png') || fileUrl.toLowerCase().includes('.gif') ||
                           fileUrl.toLowerCase().includes('.webp') || fileUrl.toLowerCase().includes('image');
            
            modal.innerHTML = `
                <div class="preview-modal bg-white rounded-lg max-w-4xl max-h-[90vh] overflow-hidden">
                    <div class="flex items-center justify-between p-4 border-b">
                        <h3 class="text-lg font-medium">${fileName}</h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-500 hover:text-gray-700">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    <div class="p-4 overflow-auto max-h-[calc(90vh-80px)]">
                        ${isPDF ? 
                            `<iframe src="${fileUrl}" width="100%" height="600" frameborder="0"></iframe>` :
                            isImage ?
                            `<img src="${fileUrl}" alt="${fileName}" class="max-w-full h-auto" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                             <div style="display:none;" class="text-center py-8">
                                <i class="fas fa-exclamation-triangle text-yellow-500 text-2xl mb-2"></i>
                                <p class="text-gray-600">N√£o foi poss√≠vel carregar a imagem.</p>
                                <a href="${fileUrl}" target="_blank" class="text-blue-600 hover:text-blue-800 mt-2 inline-block">
                                    <i class="fas fa-external-link-alt mr-1"></i>Abrir em nova aba
                                </a>
                             </div>` :
                            `<div class="text-center py-8">
                                <i class="fas fa-file text-gray-400 text-4xl mb-4"></i>
                                <p class="text-gray-600 mb-4">Tipo de arquivo n√£o suportado para visualiza√ß√£o.</p>
                                <a href="${fileUrl}" target="_blank" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">
                                    <i class="fas fa-external-link-alt mr-1"></i>Abrir arquivo
                                </a>
                             </div>`
                        }
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            
            // Fechar modal ao clicar fora
            modal.addEventListener('click', (e) => {
                if (e.target === modal) modal.remove();
            });
        };
        
        // Fun√ß√£o para visualizar arquivo (para usu√°rios)
        window.previewUserFile = function(fileUrl, fileName) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            
            // Melhorar detec√ß√£o do tipo de arquivo
            const isPDF = fileUrl.toLowerCase().includes('.pdf') || fileUrl.toLowerCase().includes('pdf');
            const isImage = fileUrl.toLowerCase().includes('.jpg') || fileUrl.toLowerCase().includes('.jpeg') || 
                           fileUrl.toLowerCase().includes('.png') || fileUrl.toLowerCase().includes('.gif') ||
                           fileUrl.toLowerCase().includes('.webp') || fileUrl.toLowerCase().includes('image');
            
            modal.innerHTML = `
                <div class="preview-modal bg-white rounded-lg max-w-4xl max-h-[90vh] overflow-hidden">
                    <div class="flex items-center justify-between p-4 border-b">
                        <h3 class="text-lg font-medium">${fileName}</h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-500 hover:text-gray-700">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    <div class="p-4 overflow-auto max-h-[calc(90vh-80px)]">
                        ${isPDF ? 
                            `<iframe src="${fileUrl}" width="100%" height="600" frameborder="0"></iframe>` :
                            isImage ?
                            `<img src="${fileUrl}" alt="${fileName}" class="max-w-full h-auto" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                             <div style="display:none;" class="text-center py-8">
                                <i class="fas fa-exclamation-triangle text-yellow-500 text-2xl mb-2"></i>
                                <p class="text-gray-600">N√£o foi poss√≠vel carregar a imagem.</p>
                                <a href="${fileUrl}" target="_blank" class="text-blue-600 hover:text-blue-800 mt-2 inline-block">
                                    <i class="fas fa-external-link-alt mr-1"></i>Abrir em nova aba
                                </a>
                             </div>` :
                            `<div class="text-center py-8">
                                <i class="fas fa-file text-gray-400 text-4xl mb-4"></i>
                                <p class="text-gray-600 mb-4">Tipo de arquivo n√£o suportado para visualiza√ß√£o.</p>
                                <a href="${fileUrl}" target="_blank" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">
                                    <i class="fas fa-external-link-alt mr-1"></i>Abrir arquivo
                                </a>
                             </div>`
                        }
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            
            // Fechar modal ao clicar fora
            modal.addEventListener('click', (e) => {
                if (e.target === modal) modal.remove();
            });
        };

        // Fun√ß√£o melhorada para upload de comprovantes com Firebase Storage
        window.uploadProof = function(input) {
            const pidx = +input.dataset.pidx;
            const midx = +input.dataset.midx;
            const participant = participants[pidx];
            const file = input.files[0];
            
            if (!file) return;
            
            // Verificar se o usu√°rio est√° autenticado para este participante
            if (!isAuthenticated() || authenticatedCPF !== participant.cpf) {
                alert('Voc√™ precisa estar autenticado para fazer upload de comprovantes.');
                input.value = '';
                return;
            }
            
            // Verificar tipo de arquivo
            if (!file.type.match('image.*') && file.type !== 'application/pdf') {
                alert('Apenas imagens e PDFs s√£o permitidos.');
                input.value = '';
                return;
            }
            
            // Verificar tamanho do arquivo (m√°ximo 10MB)
            if (file.size > 10 * 1024 * 1024) {
                alert('O arquivo deve ter no m√°ximo 10MB.');
                input.value = '';
                return;
            }
            
            // Mostrar indicador de carregamento
            const loadingText = input.parentElement.querySelector('.text-xs');
            if (loadingText) {
                loadingText.textContent = 'Enviando...';
                loadingText.className = 'text-blue-600 text-xs ml-1';
            }
            
            // Criar nome √∫nico para o arquivo
            const timestamp = Date.now();
            const fileExtension = file.name.split('.').pop();
            const fileName = `${participant.cpf}_${monthNames[midx]}_${timestamp}.${fileExtension}`;
            const storageRef = storage.ref(`comprovantes/${fileName}`);
            
            // Upload para Firebase Storage
            const uploadTask = storageRef.put(file);
            
            uploadTask.on('state_changed', 
                (snapshot) => {
                    // Progresso do upload
                    const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                    if (loadingText) {
                        loadingText.textContent = `Enviando... ${Math.round(progress)}%`;
                    }
                },
                (error) => {
                    // Erro no upload
                    console.error('Erro no upload:', error);
                    alert('Erro ao enviar arquivo. Tente novamente.');
                    if (loadingText) {
                        loadingText.textContent = 'Erro no envio';
                        loadingText.className = 'text-red-600 text-xs ml-1';
                    }
                    input.value = '';
                },
                () => {
                    // Upload conclu√≠do com sucesso
                    uploadTask.snapshot.ref.getDownloadURL().then((downloadURL) => {
                        // Salvar URL no Firestore
                        const newProofs = [...participant.proofs];
                        newProofs[midx] = downloadURL;
                        
                        // Salvar no Firestore com metadados
                        const proofData = {
                            url: downloadURL,
                            fileName: fileName,
                            originalName: file.name,
                            fileSize: file.size,
                            fileType: file.type,
                            uploadDate: firebase.firestore.FieldValue.serverTimestamp(),
                            participantId: participant.id,
                            month: midx,
                            monthName: monthNames[midx]
                        };
                        
                        // Atualizar no Firestore
                        updateParticipant(participant.id, { 
                            proofs: newProofs,
                            [`proofsData.${midx}`]: proofData
                        });
                        
                        if (loadingText) {
                            loadingText.textContent = '‚úì Enviado';
                            loadingText.className = 'text-green-600 text-xs ml-1';
                        }
                        
                        // Atualizar a interface
                        renderParticipants();
                        
                        alert('Comprovante enviado com sucesso!');
                    });
                }
            );
        };

        // Fun√ß√£o para baixar arquivo do Firebase Storage
        window.downloadFile = function(fileUrl, fileName) {
            // Se for uma URL do Firebase Storage, fazer download direto
            if (fileUrl.includes('firebasestorage')) {
                const link = document.createElement('a');
                link.href = fileUrl;
                link.download = fileName;
                link.target = '_blank';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            } else {
                // Para URLs locais (blob)
                const link = document.createElement('a');
                link.href = fileUrl;
                link.download = fileName;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
        };

        // Fun√ß√£o para deletar arquivo do Firebase Storage (apenas admin)
        window.deleteFile = function(participantId, monthIndex) {
            if (!isAdmin) {
                alert('Apenas administradores podem deletar arquivos.');
                return;
            }
            
            if (confirm('Tem certeza que deseja deletar este arquivo?')) {
                const participant = participants.find(p => p.id === participantId);
                if (!participant || !participant.proofs[monthIndex]) return;
                
                const fileUrl = participant.proofs[monthIndex];
                
                // Se for uma URL do Firebase Storage, deletar do storage
                if (fileUrl.includes('firebasestorage')) {
                    const storageRef = storage.refFromURL(fileUrl);
                    storageRef.delete().then(() => {
                        // Remover do Firestore
                        const newProofs = [...participant.proofs];
                        newProofs[monthIndex] = null;
                        
                        updateParticipant(participantId, { 
                            proofs: newProofs,
                            [`proofsData.${monthIndex}`]: firebase.firestore.FieldValue.delete()
                        });
                        
                        alert('Arquivo deletado com sucesso!');
                        renderParticipants();
                    }).catch((error) => {
                        console.error('Erro ao deletar arquivo:', error);
                        alert('Erro ao deletar arquivo.');
                    });
                }
            }
        };

        // Sistema de backup autom√°tico para produ√ß√£o
        function createBackup() {
            if (!isAdmin) return;
            
            const backupData = {
                participants: participants,
                totalHouseValue: totalHouseValue,
                timestamp: new Date().toISOString(),
                version: '1.0'
            };
            
            // Salvar backup no Firestore
            db.collection('backups').add(backupData).then(() => {
                console.log('Backup criado com sucesso');
            }).catch((error) => {
                console.error('Erro ao criar backup:', error);
            });
        }

        // Fun√ß√£o para restaurar backup
        window.restoreBackup = function() {
            if (!isAdmin) {
                alert('Apenas administradores podem restaurar backups.');
                return;
            }
            
            if (confirm('Tem certeza que deseja restaurar o √∫ltimo backup? Isso substituir√° todos os dados atuais.')) {
                db.collection('backups').orderBy('timestamp', 'desc').limit(1).get().then((snapshot) => {
                    if (!snapshot.empty) {
                        const backup = snapshot.docs[0].data();
                        participants = backup.participants || [];
                        totalHouseValue = backup.totalHouseValue || 5000;
                        
                        // Atualizar interface
                        renderParticipants();
                        updatePaymentSummary();
                        
                        alert('Backup restaurado com sucesso!');
                    } else {
                        alert('Nenhum backup encontrado.');
                    }
                }).catch((error) => {
                    console.error('Erro ao restaurar backup:', error);
                    alert('Erro ao restaurar backup.');
                });
            }
        };

        // Fun√ß√£o para exportar dados
        window.exportData = function() {
            if (!isAdmin) {
                alert('Apenas administradores podem exportar dados.');
                return;
            }
            
            const exportData = {
                participants: participants,
                totalHouseValue: totalHouseValue,
                exportDate: new Date().toISOString(),
                version: '1.0'
            };
            
            const dataStr = JSON.stringify(exportData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `road-trip-backup-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            alert('Dados exportados com sucesso!');
        };

        // Fun√ß√£o para importar dados
        window.importData = function() {
            if (!isAdmin) {
                alert('Apenas administradores podem importar dados.');
                return;
            }
            
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const importData = JSON.parse(e.target.result);
                        
                        if (confirm('Tem certeza que deseja importar estes dados? Isso substituir√° todos os dados atuais.')) {
                            participants = importData.participants || [];
                            totalHouseValue = importData.totalHouseValue || 5000;
                            
                            // Salvar no Firestore
                            participants.forEach(participant => {
                                if (participant.id) {
                                    participantsCol.doc(participant.id).set(participant);
                                }
                            });
                            
                            totalValueDoc.set({ value: totalHouseValue });
                            
                            // Atualizar interface
                            renderParticipants();
                            updatePaymentSummary();
                            
                            alert('Dados importados com sucesso!');
                        }
                    } catch (error) {
                        console.error('Erro ao importar dados:', error);
                        alert('Erro ao importar dados. Verifique se o arquivo √© v√°lido.');
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        };

        // Criar backup autom√°tico a cada 24 horas
        setInterval(createBackup, 24 * 60 * 60 * 1000);

        // Adicionar bot√µes de backup no painel administrativo
        function addBackupButtons() {
            const adminPanel = document.getElementById('adminPanel');
            const backupSection = document.createElement('div');
            backupSection.className = 'mt-6 p-4 bg-yellow-50 rounded-lg border border-yellow-200';
            backupSection.innerHTML = `
                <h4 class="text-lg font-medium text-yellow-800 mb-3">Sistema de Backup</h4>
                <div class="flex flex-wrap gap-2">
                    <button onclick="exportData()" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded text-sm transition duration-200">
                        <i class="fas fa-download mr-1"></i> Exportar Dados
                    </button>
                    <button onclick="importData()" class="bg-green-600 hover:bg-green-700 text-white px-3 py-2 rounded text-sm transition duration-200">
                        <i class="fas fa-upload mr-1"></i> Importar Dados
                    </button>
                    <button onclick="restoreBackup()" class="bg-orange-600 hover:bg-orange-700 text-white px-3 py-2 rounded text-sm transition duration-200">
                        <i class="fas fa-undo mr-1"></i> Restaurar Backup
                    </button>
                </div>
                <p class="text-xs text-yellow-700 mt-2">
                    <i class="fas fa-info-circle mr-1"></i> 
                    Backup autom√°tico criado a cada 24 horas. Use "Exportar Dados" para criar um backup manual.
                </p>
            `;
            adminPanel.appendChild(backupSection);
        }

        // Chamar fun√ß√£o para adicionar bot√µes de backup
        addBackupButtons();
        
        // Event listeners para filtros
        document.getElementById('filterImages').addEventListener('change', renderFilesList);
        document.getElementById('filterPDFs').addEventListener('change', renderFilesList);
        document.getElementById('filterParticipant').addEventListener('change', renderFilesList);
        document.getElementById('filterMonth').addEventListener('change', renderFilesList);
        
        // Atualizar lista de participantes no filtro
        function updateParticipantFilter() {
            const select = document.getElementById('filterParticipant');
            select.innerHTML = '<option value="">Todos os participantes</option>';
            participants.forEach((participant, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = participant.name;
                select.appendChild(option);
            });
        }
        
        // Modificar a fun√ß√£o renderParticipants para atualizar o filtro
        const originalRenderParticipants = renderParticipants;
        renderParticipants = function() {
            originalRenderParticipants();
            updateParticipantFilter();
        };
        
        // Fun√ß√£o para criar participantes de teste (apenas para desenvolvimento)
        function createTestParticipants() {
            if (participants.length === 0) {
                const testParticipants = [
                    { name: "Jo√£o Silva", cpf: "12345678901" },
                    { name: "Maria Santos", cpf: "98765432100" },
                    { name: "Pedro Oliveira", cpf: "45678912345" },
                    { name: "Ana Costa", cpf: "78912345678" }
                ];
                
                testParticipants.forEach(p => {
                    addParticipant(p.name, p.cpf);
                });
                
                alert("Participantes de teste criados com sucesso!\n\nCPFs para teste:\n‚Ä¢ Jo√£o Silva: 12345678901\n‚Ä¢ Maria Santos: 98765432100\n‚Ä¢ Pedro Oliveira: 45678912345\n‚Ä¢ Ana Costa: 78912345678");
            } else {
                alert("J√° existem participantes cadastrados. Limpe a lista primeiro se quiser criar novos participantes de teste.");
            }
        }
        
        // Descomente a linha abaixo para criar participantes de teste automaticamente
        // createTestParticipants();

        // Fun√ß√£o para fazer logout
        window.logoutUser = function() {
            if (confirm('Deseja sair da autentica√ß√£o?')) {
                authenticatedCPF = null;
                renderParticipants(); // Atualizar interface
                alert('Logout realizado com sucesso!');
            }
        };

        // Fun√ß√£o para copiar chave PIX
        window.copyPixKey = function() {
            const pixKey = "17282663785";
            const monthlyValue = getPerMonth().toFixed(2).replace('.', ',');
            const copyText = `Chave PIX: ${pixKey}\nValor da parcela: R$ ${monthlyValue}`;
            
            // Usar a API moderna do navegador se dispon√≠vel
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(copyText).then(() => {
                    showCopyStatus();
                }).catch(() => {
                    // Fallback para navegadores mais antigos
                    fallbackCopyTextToClipboard(copyText);
                });
            } else {
                // Fallback para navegadores mais antigos
                fallbackCopyTextToClipboard(copyText);
            }
        };

        // Fun√ß√£o fallback para copiar texto
        function fallbackCopyTextToClipboard(text) {
            const textArea = document.createElement("textarea");
            textArea.value = text;
            textArea.style.top = "0";
            textArea.style.left = "0";
            textArea.style.position = "fixed";
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    showCopyStatus();
                } else {
                    alert('Erro ao copiar. Tente selecionar e copiar manualmente: ' + text);
                }
            } catch (err) {
                alert('Erro ao copiar. Tente selecionar e copiar manualmente: ' + text);
            }
            
            document.body.removeChild(textArea);
        }

        // Fun√ß√£o para mostrar status de c√≥pia
        function showCopyStatus(message = 'Chave PIX copiada!') {
            const statusElement = document.getElementById('copyStatus');
            statusElement.innerHTML = `<i class="fas fa-check mr-1"></i>${message}`;
            statusElement.style.display = 'block';
            
            // Esconder a mensagem ap√≥s 3 segundos
            setTimeout(() => {
                statusElement.style.display = 'none';
            }, 3000);
        }

        // Fun√ß√£o para copiar apenas a chave PIX
        window.copyPixKeyOnly = function() {
            const pixKey = "17282663785";
            
            // Usar a API moderna do navegador se dispon√≠vel
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(pixKey).then(() => {
                    showCopyStatus('Apenas a chave PIX foi copiada!');
                }).catch(() => {
                    // Fallback para navegadores mais antigos
                    fallbackCopyTextToClipboard(pixKey);
                    showCopyStatus('Apenas a chave PIX foi copiada!');
                });
            } else {
                // Fallback para navegadores mais antigos
                fallbackCopyTextToClipboard(pixKey);
                showCopyStatus('Apenas a chave PIX foi copiada!');
            }
        };
    </script>
</body>

</html>